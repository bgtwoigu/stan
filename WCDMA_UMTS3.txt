==UMTS和WCDMA到底是什么==
Wideband-CDMA
WCDMA是由GSM发展而来的一种新的制式"名"
WCDMA仍旧保留着很多GSM中已有的东西,例如:NAS非接入层构成:MM,GMM(GPRS-MM),CM(CC,SMS,SS(CS-domain)/SM-session management(PS-domain))
AS接入层:RRC;layer1;layer2
在SIM基础上发展而来的USIM

UMTS(universal mobile telecommunications system)
*3G,基于CDMA无线接入网络,频率3.84Mcps
*基于GSM/GPRS系统网络发展起来的,应用标准一致
*频分双工\时分双工,如果是频分双工模式需要成对的频段
*支持大量新兴服务,高传输速率(PS域可达 1.96Mbps, CS域最大可达384kbps)

提供wireline的话音质量,提高容量和频带利用率,利用AMR(适应多种频率的发声器)在EFR增强型全速率编码方式上面

P19	各类模块/layer的协议标准
acronyms名词英文缩写表 21.905
release 99/specifications(specs)完整规格协议列表 21.101

==谈谈3gpp==
(www.3gpp.org)
3gpp第三代伙伴项目计划意图继续发展维护UMTS的协议规则,主要由ARIB,CWTS,ETSI,T1,TTA,TTC组成.
3gpp一开始涉及的范围是在GSM核心网络基础上发展第三代移动通信系统和为(FDD,TDD)无线接入新技术提供支持,后来发展过程中又加入了新的无线接入技术例如GPRS,EDGE(增强型数据传输-GSM演化)

==UMTS-standard==
release 99 features:
新的无线接口(UTRAN),码片速率=3.84Mcps(M chip per second)
//码片速率＝符号速率×扩频因子 
//符号速率＝(业务速率＋校验码)×信道编码×重复或打孔率 
多媒体消息
GSM/GPRS协同工作
支持多个来电
基础的UMTS安全性能
通过空中接口的定位服务

release 4 features:
TDD码片速率1.28Mcps
UTRA(UMTS-地面无线接入)中继器
CS域紧急呼叫增强
核心网CN传输协议演化
bearers承载独立与CS架构

release 5 features:
UTRAN传输网络协议演化
基于ip的多媒体服务
高速下行分组接入技术(HSDPA)
PS域中可靠的QoS

release 4和5指示99的补充部分

==UMTS网络结构==
非接入层NAS:CS-domain/PS-domain
接入层AS:
1.UTRA-FDD(此种无线接入系统使用的WCDMA协议); 
2.UTRA-TDD(使用的TDD协议,包括了TDD at 3.84Mcps和TDD at 1.28Mcps,这种制式也被叫做TD-SCDMA); 
3.GSM/GPRS

"UMTS"就是包括了两个核心网络(CS,PS),囊括了3种类型的无线接入网络的综合性的移动通信系统的集合"称呼".

only FDD协议是被addressed的
WCDMA是FDD物理层和协议栈所支持的
UTRAN归属于WCDMA的无线接入网络
WCDMA意味着"NTT DOCOMO"? WCDMA代表着在UMTS中采用FDD制式的无线接入网络(由3gpp定义)

==UMTS的重要技术概念(concepts)==
===编码方式的变化===
FDMA:每个用户指定一个特定频点(一个呼叫过程中不能改变),允许系统的多接入,第一代模拟系统就是使用的单频分多址系统.
TDMA:一个频带分为多个频点,一个频点再时分为多个"时间片","跳频"允许用户接入这个频带内任一频点的任一"时间片"内.
CDMA:多用户占用同样的频带和时间片,通过唯一的分配码来区分彼此,在接收处信号是通过相关器只接受信号能量来自于指配码信道的,所有在该频带的其他信号都只会被认为是"噪声",CDMA2000和WCDMA都是使用的这个基础CDMA调制概念.

类似于一个大房间里很多人同时用不同的语言交谈,你只会识别你"认识"的语言而过滤掉其他的信息,无线网络也是如此,根据特定的分配码,识别对应的信息,同时还会进行power control过程(对于微弱的信号请求加强,对于"嘈杂"的信号请求减弱),减小互相干扰,但也不影响正常识别.

===频带分配===
UMTS FDD:
上行			下行
1920-1980Mhz 	2110-2170Mhz
1850-1910Mhz 	1930-1990Mhz	(GSM1900?)
频带宽度:	60Mhz
频带间隔:	190Mhz/80Mhz
频点间隔:	200Khz

===信道特点===
UMTS信道带宽空间名义是5Mhz,但是可以根据特殊的应用优化调整,信道的间隔是200Khz,意味着每个信道的中心频率值(频点)一定是200Khz的整数倍,信道编号即"UTRFCN".
频点号"UARFCN(UTRA absolute radio frequency channel number)" x 200Khz = 所在频点的频值大小
UTRA = UMTS Terrestrial(地面) Radio Access

===功率控制===
根据收到功率的大小来发出需要增强或减弱的请求,平衡路径不同带来的损耗差异,形成一个闭环的功率调整系统.

===切换===
WCDMA系统中,软切换使用优于硬切换,软切换可以先确定目标切换小区后再决定如何处理与原服务小区的连接,UE和多个小区的连接之间不会互相影响,且也可以同时连接多个小区.

===UMTS系统的网络拓扑结构===
UE:USIM和mobile端
Access network:一个或多个nodeB---RNC
core network:PS domain(SGSN,GGSN(GGSN类比于PS域里的"GMSC"))---(internet); CS domain(MSC/VLR,GMSC(MSC之间的汇接))--(PSTN/ISDN)
对于WCDMA制式的系统,CN实际就是GSM/GPRS系统的演化升级,UTRAN的接口是新加的东西,不同于以往的Um无线接口,nodeB和RNC也和BTS,BSC有差异.
PS和CS domain共享同一个auc和HLR,UE可以再GSM和WCDMA之间切换,GSM系统通过A/Gb接口和MSC/SGSN两个域相连,UTRAN通过对应的lu接口互连.

USIM:universal subscriber identity module/manage UE subscription info and authentication functions
include a universal integrated circuit card(UICC)

===网络结构===
cell/Route Areas/URA/Location Areas
传统nodeB一般会包含3个cell,在CS域cell都在被LA控制,在PS域里,路由和移动性管理MM由RA控制,小区,路由区,位置区都属于URA内部结构,被用来管理处于连接模式下的UE的位置情况,RA只对应一个LA,一个LA可以对应多个RA,URA一般比LA和RA要小(不绝对限制),URA是UTRAN网络的一部分.

===信令协议栈===
域			CS domain					PS domain
NAS:		CM(SMS短消息服务,CC,SS)		SMS/SM(session management/处理PS域的call的建立和释放)
			MM							G(GPRS)MM
AS:	layer3	RRC							RRC
	layer2	RLC							RLC
			MAC							MAC
	layer1	Physical layer				Physical layer

UMTS的非接入层和GSM的相似,主要的不同点在于WCDMA接入层协议栈和各个接口

控制面的协议栈:展示信令协议如何起始结束,CS域的call怎么运行在专用的物理信道上
CM:负责UE和MSC之间的呼叫建立和释放
MM:负责UE和MSC之间的移动性管理
RRC:UE和RNC之间的无线资源的建立,释放,配置
RLC:在UE和RNC之间提供segmentation,re-assembly,重新检测,layer 2的信令传输
MAC:UE和RNC之间-多路复用-用户面和控制面的数据
物理层:UE和nodeB/nodeB和RNC之间传输数据所需要的无线链路的连接Uu,它们之间的物理层的接口处理组合和拆分两个工作

用户面协议栈:展示用户协议如何起始终止
NAS:一个包含了很多layers的application,处于远程用户/MSC和UE之间,通过两端都设置有的话音编码器发出或接受信号,传输通过无线方式或者数字线路
RRC:用户面协议栈没有RRC
RLC/MAC/物理层:功能和控制面的一样

接入层:
RRC:整个接入层的控制器,负责配置提供AS所有层面向NAS层的信令接口,管理无线资源(分配,逻辑配置,传输,物理信道等等)
BMC(boardcast/multicast control):小区广播消息的存储,调度,传输,发送,请求无线资源
PDCP(packet data convergence protocol):分组数据的压缩和解压
RLC:无线接入链路的控制;加密;segmentation;re-assembly;重新检测;提供ACK/UNACK响应;transparent的数据传输模式
MAC:映射和多路复用逻辑信道到传输信道;UE认证;随机接入信道;加密;处理数据流的优先级
physical layer:前向纠错编码/解码;传输信道上的错误删除;软切换和宏分集的分配/组合;交织/反交织;多路复用/解多路复用;rate匹配;调制/解调;频率和时间(chip,bit,slot,frame)同步;闭环功率控制;RF进程;spreading(扩展)/despreading......

future channels(not exist in release 99):
Common Packet Channel (CPCH) – Uplink Transport Channel
Physical Common Packet Channel (PCPCH) – Uplink Physical Channel
Common Traffic Channel (CTCH) – Downlink Logical Channel
Downlink Shared Channel (DSCH) – Downlink Transport Channel
Physical Downlink Shared Channel (PDSCH) – Downlink Physical Channel

寻呼信道PCH和PICH,UTRAN不间断在PCH上播放广播信息,UE只监测对应PICH,PICH指示着一组移动端的信息是否传输到对应的SCCPCH上,all的UE分配给一个特定的PICH,而且PICH的指示器会解码联合的SCCPCH信道内容去判断哪一个UE的信息是需要被寻址/寻呼的.

BCCH逻辑信道携带系统消息,驻留在WCDMA小区,UTRAN广播持续发送消息,在一个系统配置的重复频率重复发送系统消息,UE在进入一个小区或开机后读取该信道,确保UE获得了正确的最新的系统消息

FACH和RACH:
携带UTRAN到空闲模式下的UE的消息,用于UE没有一个专用信道的时候,RACH有一个接入协议,UE会传送一个协议头去提高发射功率直到UTRAN在AICH做出响应,收到响应之后,UE会发送剩下的RACH信道的信息.
当UTRAN全部收到来自UE的RACH信道消息,它会对在FACH上发出响应,前向传送信道映射在SCCPCH上,这可能是和搭载过PCH的同一个物理信道.

专用信道携带着信令和用户信息数据,这些信道在呼叫被发起时或分组数据传输时才会被指配,通常来说DCCH被指配去负载RRC和NAS的信令,这也被叫做SRB(信令的无线承载).两个SRB去负载RRC信令,其中一个配置响应模式,另一个配置unack模式;如果SRB被指配去负载NAS信令,两个分别去负载高优先级和低优先级的信息.
专用业务信道DTCH由所使用的应用服务类型来指配,对于话音,可适应的多频声码器使用3个DTCH去承载不同的编码话音信号;DCCH和DTCH在DCH传输信道上实现多路复用,每一个都指配给一个独立的DCH;所有DCH传输信道可以multiplexed在一个单独的DPDCH上,未来还会支持多路的DPDCH;DPCCH携带着去更新物理层的控制信息,例如导频信息,功率控制,rate bit......

==接入层的-信令层==
===UE识别鉴定/呼叫状态===
编号计划:IMSI/IMEI/C-RNTI/U-RNTI/TMSI(VLR分配,CS域临时id)/P-TMSI(由SGSN分配,PS域临时id)
C-RNTI在UE建立RRC连接时被分配,用于保持UE在公共信道上的连接.
U-RNTI在UE建立RRC连接时被分配,用于小区更新/URA更新/RRC连接的重建/UTRAN发起寻呼

UE call states:
1.idle mode
只有下行的PCH.
空闲模式可以分为"驻留在UTRAN的cell中"或"GSM/GPRS的cell中",当没有CS/PS域的呼叫时UE会处在空闲模式,UE会在它的寻呼周期检测PCH和PICH,以便UE可以做出回应,UE也可以自己主动发起呼叫过程,直接通过RACH向UTRAN(RNC)发起RRC连接请求.
移动性管理:空闲模式下,对于CS域服务,UE表现为"位置区的更新",当UE进入一个新的位置区,UTRAN会向该位置区内的所有小区发起对UE的寻呼;对于PS域服务,表现为"routing area(路由区)的更新".
addressing:空闲模式下,UTRAN对UE进行寻址通过IMSI,TMSI或者P-TMSI进行.
call types:空闲模式下,没有活动呼叫被允许,然而一个PS域的呼叫应该处于"上下文保留"的状态.

2.cell_DCH
上下行都是通过DCH.
UTRAN的4种连接状态的状态转换,可以由cell_FACH状态下建立DPCH(专用物理信道)来转换到DCH状态,也可以在空闲模式下通过RRC的建立和释放达到互相转换.
移动性管理:UTRAN在UE更换了小区时发起"切换"过程,相应小区的新信道建立替换旧的.
addressing:因为都在专用信道上,所以不需要寻址,对应的RNTI(无线网络临时识别码)会在RRC建立时分配.
call types:CS(总是)/PS域(可能)的呼叫运行在在cell_DCH状态下,CS域需要稳定的专用信道用于传输;PS域的呼叫需要高速的数据传输条件,网络也需要保证稳定性.

3.cell_FACH
下行FACH,上行RACH.
状态转换:空闲模式通过RRC连接建立;cell_DCH状态通过释放专用信道;cell_pch和ura_pch状态下UE发起需求信令传输或用户数据传输;在fach状态下,UE持续监测FACH,避免错过UTRAN端发送来的数据或者信令.
移动性管理:UTRAN在UE发生小区变换时发起"小区的更新".
addressing:在前向接入信道中,UTRAN通过C-RNTI或U-RNTI(RRC连接建立时被分配)来寻址.
call types:PS域呼叫可能运行在此状态,?突发性的分组数据服务可以忍受公共信道的低吞吐量.

4.cell_PCH
只有PCH的下行.
可通过RACH响应寻呼或者UE自己发起寻呼从cell_PCH转换到cell_FACH状态;当UTRAN监测到UE在PS域呼叫过程中缺少activity,可以由cell_DCH或cell_FACH转换到cell_PCH状态.
移动性管理:当UE位置小区变换,UTRAN发起"小区更新".(需要先切换到cell_FACH状态下在进行更新)
addressing:根据U-RNTI来寻址.
call types:PS域呼叫可能因为低活动性进入到cell_PCH状态,当发起任何数据传输后又会变成cell_FACH状态.

5.ura_PCH
只有下行的PCH.
和cell_PCH变换形式一样,从DCH/FACH因为低活动性变换到PCH,从PCH因为响应寻呼/UE发起寻呼变换到FACH状态.
移动性管理:当UE的RA(路由区)变化时,发起"URA的更新过程",UTRAN在RA内的所有小区发起对UE的寻呼.
addressing:和cell_PCH一样,根据U-RNTI来寻址.
call types:PS域呼叫可能因为低活动性进入到ura_PCH,特别是低活动性对应着高移动性的时候,而当发起任何数据传输后又会变成cell_FACH状态.

===接入层/协议栈===

===RRC===
整个接入层的控制器,负责配置提供AS所有层面向NAS层的信令接口,管理无线资源(分配,逻辑配置,传输,物理信道等等)

1.(BCH)系统消息的广播:系统消息包含接入层和非接入层的系统消息元素,MIB主消息块每80ms发送一次,包含信息有MCC/MNC/SIBs.
CS_CN/PS_CN--(CS_CN/PS_CN broadcast information)-->RNC--(MIB/SIB)-->UE
系统消息类型部分可以参考WCDMA_UMTS1文件---#196

2.RRC连接管理:
RRC连接的建立和释放流程可以参考WCDMA_UMTS1文件---#255/#383
RRC连接出现的原因:用户发起主叫/被叫去响应寻呼/位置区或路由区的更新

3.RB的管理
大致分为3个信令流程部分:UE和UTRAN之间的RB的建立/确认;RB的重配置/确认;RB释放/确认完成
RB的建立和重配置包含的信息:映射逻辑信道到物理传输信道/RLC层参数(模式,大小,优先级,逻辑信道数)/MAC层参数(物理传输信道类型和UE认证信息)/物理传输信道参数(传输时间间隔,扩展因子,wcrambling code number,传输信道结合集)
物理信道和传输信道可能通过不同信息来分别配置.

4.mobility
移动性管理主要包含:活动集的更新/小区更新/ura信息更新
在空闲模式下,RRC层负责初始化小区选择和小区重选,广播消息也会携带相关的选择和重选参数.
在连接模式下,保持RRC的连接,跟踪UE的位置区/路由区/URA信息.
在cell_DCH状态下,UE-RRC向UTRAN发送测量报告,UTRAN做出响应的切换判决,在软切换中因为无线链路的增加/删除/替换导致UTRAN会发起活动集的更新信息.
cell_FACH和cell_PCH状态下,RRC持续监测小区信息,在UE改变服务小区时提醒UTRAN发起小区更新过程.
URA_PCH状态下,在UE变换到新URA时,提醒UTRAN发起URA更新过程.
*ura_PCH/cell_PCH和idle状态下UE做的事基本都一样,监听PCH和PICH的寻呼信息,关键区别在UE和UTRAN之间有没有建立RRC的连接.

5.寻呼和提醒
两种寻呼消息类型:type 1(idle/cell_pch/ura_pch状态);type 2(cell_dch/fach状态);类型1般用于在建立RRC连接去传输一个呼叫,或者在分组数据中RB已经建立的情况下去重启用户数据传输过程;类型2一般用于二次呼叫的发起,利用已经建立的条件在第一个呼叫的同时发起另一个呼叫.
下行由PCH信道承载寻呼消息,上行DCH或FACH承载UE对于寻呼消息的回应.

6.NAS层信息的路由/信令直传连接的建立
下行的DCH/FACH,上行的RACH
NAS--(CM services request)-->UE.RRC--(DCCH:initial DT/CM services request)-->RNC.RRC--(CM service request)-->CS.CN;
CS.CN--(MM auth request)-->RNC.RRC--(DCCH:DL DT/MM auth request)-->UE.RRC--(MM auth request)-->NAS;
NAS--(MM auth response)-->UE.RRC--(DCH/RACH:UL DT/MM auth response)-->RNC.RRC--(MM auth response)-->CS.CN;
NAS层之间,UTRAN和UE.RRC层的路由信息通过AS的协议使用直传方式传输(初始化直传建立RNC到CN的连接),RRC层会为NAS消息提供一个"保护罩",包含消息类型,完整的保护信息,额外的RACH测量信息,不会改变原NAS消息的内容,RRC层会把接收到的消息路由到"发起该信息请求"的NAS层的核心网络中去.

7.加密控制和完善的保护机制
RNC--(DCH/FACH:security mode cmd)-->UE--(DCH/RACH:security mode complete)-->RNC
RRC可能会需要启动的的加密或者保护机制,加密会需要配置MAC/RLC层.
完整的保护机制会让RRC去为每一个传输信息计算一个鉴权码MAC-I(Message authentication code),鉴权码是使用当前统一的密钥计算得来,这会为每条信息提供一个在UE和UTRAN之间信息交换的鉴权等级,避免错误和不合法的信息阻碍用户数据的传输.

8.测量报告及控制
RNC--(DCH/FACH:measurement control(携带需要测量UE和邻小区的信息类型))-->UE--(DCH/RACH:measurement report)-->RNC
只有当UE处于cell_FACH/cell_DCH状态下才能进行测量信息的控制和上报,UTRAN负责发出测量控制,UE测量相应的信息并在触发时间点将测量报告上报.
测量控制:测量建立/测量修改modify/测量释放
可以测量的信息类型:
频内测量(Intra-frequency measurement):测量与激活集相同频率的下行物理信道.测量对象为一个小区.
频间测量(Inter-Frequency measurement):测量与激活集不同频率的下行物理信道.测量对象为一个小区.
Inter-RAT 测量(Inter-RAT measurement):测量其他无线接入系统(如GSM)的下行物理信道.测量对象为一个小区.
业务量测量(Traffic volume measurement):测量上行链路的业务量.测量对象为一个小区.(RLC缓冲负荷量)
质量测量(Quality measurement):测量下行链路专用传输信道的质量参数有两种.(block error rate)
UE内部测量(UE internal measurement):测量UE的发射功率,接收信号强度及TADV.
UE定位测量(UE positioning measurement):测量UE的位置.
*测量报告上报后可能引起的其他过程:切换,RB重配置,物理信道重配置,传输信道重配置...

下行BLER:测量对象为一个下行传输信道.
下行SIR(TDD):测量对象为下行专用(或共享)CCTrCH所对应各个时隙.

9.功率控制(outer loop power control)
功率控制基本是在物理层上,调整SIR目标去保持要求传输信道的BLER
物理信道建立时,UE设置一个初始化下行目标SIR(signal to interface)值基于接收到的"DCH quality target"信息,这个目标会调整去保持质量目标,质量的测量方式可能是BER(误码率)或者BLER(块错误率),取决于传输块是否有一个CRC循环校验方式.

===RLC===
1.RLC架构
传输L3层和MAC之间的用户数据和信令,数据以数据块形式传输进入RLC被称为SDU(service data units),数据以数据块形式从RLC传出被称为PDU(protocol data units).
3种数据传输模式:
TM(transparent mode):PDU以没有额外头文件信息来传输.
UM(unack mode):PDU上会加上包含长度和序列号域的头文件之后再进行传输.
AM(ack mode):PDU根据一个包含流程控制,错误检测,in-sequence delivery,duplicate detection的双向协议来传输.
数据流程在L3层和RLC之间被称为RB(可能携带信令数据SRB或者用户数据RAB),在MAC和RLC之间被称为logical channel.

2.RLC的TM(传输模式)
UE:RB-->transmitting TM RLC entity(transmission buffer-->segmentation)-->\
logical channel-->\
UTRAN:Receiving TM RLC entity(reception buffer-->reassembly)-->RB

在TM模式下,PDU的传输会受到RLC的交互影响.
segmentation and reassembly:如果SDU尺寸太大不适合放在一个PDU里,它会在发射端被分段在接收端再被重新组合在一起.
SDU discard:TM传输实体可能配置去表现为基于定时器的SDU丢弃,一个SDU不会在"时间丢弃配置"之后进行传输.

标记出传输模式下MAC层的逻辑信道的加密,话音和一些信令信道使用TM传输模式.

3.RLC的unack mode
UE:RB-->transmitting UM RLC entity(transmission buffer-->segmentation&connection-->add RLC header-->ciphering)-->\
logical channel-->\
UTRAN:Receiving UM RLC entity(deciphering-->reception buffer-->remove RLC header-->reassembly)-->RB

比TM模式提供更多可靠的信息和服务,一个小头文件,包含分段-连接-组合信息,序列号都附着在每一个PDU上.
segmentation and reassembly:如果SDU尺寸太大不适合放在一个PDU里,它会在发射端被分段在接收端再被重新组合在一起.
concatenation/padding:多个SDU可能被组合成一个PDU去填满一个可用的PDU容量大小,也可以用padding bits(无用的数据)去填满.
sequence number check:头文件中包含的序列号,可用于接收端分段数据重新组合时验证对应的SDU数据单元.
ciphering:RLC可以使能UM逻辑信道数据流的加密.
SDU discard:TM传输实体可能配置去表现为基于定时器的SDU丢弃,一个SDU不会在"时间丢弃配置"之后进行传输.

4.RLC的ack mode
流程太复杂,详细流程参考记录本.
AM模式协议是一个复杂的协议,提供了很多可靠的服务支持,包括积极的和消极的应答方式.
segmentation and reassembly:如果SDU尺寸太大不适合放在一个PDU里,它会在发射端被分段在接收端再被重新组合在一起.
concatenation/padding:多个SDU可能被组合成一个PDU去填满一个可用的PDU容量大小,也可以用padding bits(无用的数据)去填满.
error correction:PDU接收到错误信息时,接收器会循环去提示传送器发送一个回应状态报告.
in-sequence delivery:PDU向上层的传输顺序和向RLC侧的传输顺序一致.
duplicate detection:一个PDU只有在对上层时才被传送.
flow control:配置发送和接收"窗口"的大小.
protocol error detection and recovery:AM模式的RLC可以从协议错误中恢复重置.
ciphering:RLC可以使能UM逻辑信道数据流的加密.
SDU discard:TM传输实体可能配置去表现为基于定时器的SDU丢弃,一个SDU不会在"时间丢弃配置"之后进行传输.

===MAC(medium access control:介质访问控制/媒质接入控制)===
1.MAC层架构
MAC层主要负责映射逻辑信道到传输信道,根据映射在TTI(传输时间间隔)配置而在两种信道之间传输数据.
MAC-b;MAC-d;MAC-c/sh:分别控制BCH/DCH/公共信道/的接入;在L1层和RLC之间的逻辑信道和传输信道的管理.
其他功能:传输标准格式选择;传输模式信道加密;RACH的接入服务类型选择;公共信道上的UE识别;多重复用/多重逻辑信道;业务量监测......

2.逻辑信道--(映射)-->公共传输信道
BCCH-->BCH:UTRAN系统消息广播.
BCCH-->FACH:系统消息改变,UTRAN发送消息在BCCH上映射到FACH.
PCCH-->PCH:UTRAN下行寻呼消息.
CCCH-->RACH:UE发起一个上行RACH连接,可能有很多UE共用这个信道.
	-->FACH:UTRAN响应UE发起的下行连接,将公共控制信道映射在FACH上.
DCCH-->RACH:当UE处于cell_fach状态,拥有映射在FACH和RACH上的专用逻辑信道,用于传输信令信息.
	-->FACH:
DTCH-->RACH:映射在FACH和RACH上的专用业务逻辑信道,用于传输用户数据.
	--<FACH:

3.逻辑信道--(映射)-->专用传输信道
DCCH-->DCH:多个DCCH映射到同一个DCH传输信道.
DTCH-->DCH:一一对应.
DCH-->CCTrCH(Coded Composite Transport Channel编码复合传输信道),CCtrch可以映射到多个物理信道上;专用的CCtrch可以对应于一个或多个DCH的编码和复用结果,公共的只能对应一个公共信道的编码和复用结果.
CCtrch再对应到一个DPDCH(专用物理数据信道)

4.逻辑信道-多路复用/多工
多个不同类型的逻辑信道映射到一个传输信道上,SDU的头文件中的TCTF域会指示了这些被映射的逻辑信道的类型,因此接收端MAC可以将"SDU"分别路由至正确的逻辑信道.如果是多个同类型的逻辑信道映射到一个传输信道上,例如4个DCCH映射到DCH上,这种情况下,头文件里的C/T域会指示出被映射的该种逻辑信道的数量.
CCCH/DCCH/DTCH-->RACH/FACH
DCCH/DTCH-->DCH

MAC header(TCTF;UE-id-type;UE-id;C/T)---MAC SDU
TCTF:Target Channel Type Field逻辑信道的类型
C/T:Logical Channel Number该种逻辑信道的数量

5.UE 认证
UE-id type: U-RNTI 32bits/C-RNTI 16bits
一个专用逻辑信道映射到公共传输信道(DCCH/DTCH-->RACH/FACH),MAC头文件里UE-id-filed有RRC连接建立时分配的RNTI,映射过程中可能需要验证使用?
当一个公共逻辑信道映射到公共传输信道时,UE-id-field就不是必要的了,因为UE的认证包含在RRC信令消息中,之前已经在addressing matching/寻址匹配里验证过了?

6.RB的信道映射实例
1个SRB+3个RAB-->RLC PDU/逻辑信道-->transport block/传输信道-->CCTrCh(编码复合传输信道,位于物理层,多工承载上面的传输块)
在一个典型DCH配置中会有4个SRB,RAB在这个例子中携带了3组由AMR(自适应多速率)话音编码器编码的的话音帧,注意话音帧的大小是否需要分段/组合操作(一般不需要),通常在RLC中以TM模式进行传输.
4 SRB-->4 DCCH-->1 DCH(有头文件)
3 RAB-->3 DTCH-->3 DCH(无头文件)
对于信令DCH,MAC会加上头文件去识别数据发送的目标逻辑信道是哪一个;对于话音的DCH,和它的逻辑信道都是一一对应的,并不需要头文件.

7.传输标准格式
Transport Block
• Basic data unit exchanged between Physical Layer and MAC
Transport Block Set
• A set of Transport Blocks exchanged between the Physical Layer and MAC at the same time instance using the same transport channel
Transport Format (TF)
• A format offered by the Physical Layer to MAC for the delivery of a Transport Block Set during a transmission time Interval on a transport channel
Transport Format Combination (TFC)
• The combination of currently valid Transport Formats on all transport channels used by a UE
Transport Format Combination Set (TFCS)
• A set of transport format combinations used by an UE
Transport Format Combination Indicator (TFCI)
• An index into the TFCS
MAC层和物理层之间"传输块"的在各种类型传输信道上允许的大小,数量;
选择传输信道的"传输格式TFC"的时候可以参考一下的因素:逻辑信道的缓冲状态,逻辑信道的相关优先级,服务质量参数
根据逻辑信道的情况分析,MAC可能会采取不同的方式对应不同的分组,或许不会在特殊的TTI(传输时间间隔)的边界点的时候发送信息,非实时的数据会进行排队延后传输,"流媒体/直播"数据传输或许会被放弃掉.

TFCS传输格式合集-集
在每一个最小的TTI中(3种传输信道TTI分别是80/20/10ms,这里每10ms选择一次),TFC会决定每一个传输信道的传输格式(传输块大小,传输块数量);当"传输块"被送至物理层,MAC选择相应的TFC,它用TFCI索引来展示可选的TFC,通过DPCCH传输TFCI.
TFC被选择以后,在该信道的这个TTI期间,TF是不能改变的.
TFCI就是一个关于某一个传输信道的所包括的所有有效的TF的索引,用一个个数字对应一个个TF,方便选择也方便引用.

"TFC选择时间线"类似于"时序图",随着时间推进,不同传输信道根据不同TFCI值,在该信道该TTI已结束情况下,选择不同的TF并应用.

8.RACH操作流程
在UE侧,MAC层控制着RACH的传输流程.
[1]persistence check:在RACH上数据传输之前,MAC会进行持久性检测,通过生成的一个0到1之间的随机变量,对比随机变量和接入服务类型的持久性值,当检测通过后,物理层上的随机接入程序才开始启动.
[2]物理层的随机接入程序:在功率等级上升时(preamble ramping cycle),持续发送一个序文,直到AICH上出现一个积极或消极的指示消息才停止.
[3]最大的序文循环?/序文斜坡循环的编号/number of preamble ramping cycle:如果AICH没有出现ack信息,MAC会重新开始可持续性检测过程[1],当通过可持续性检测后,MAC会请求L1启动物理层的随机接入程序[2],序文循环也有最大循环数限制,达到最大限制后即认为传输过程失败,强行结束RACH流程,该循环最大限制数由系统指定大小.
[4]backoff interval timer/撤销间隔定时器:如果AICH上出现一个消极的ack信息,MAC会等待一个"随机时间"的撤销间隔,然后再一次回到可持续性检测阶段[1].

如果UTRAN的PRACH资源已经被分配掉,UTRAN可能向申请接入的系统的UE都发送消极的"捕获指示";或者是如果当UTRAN探测到多个UE都意图发起接入系统的请求,它可能只会向其中一个发送积极的指示,其余的都是消极指示.(保护当前接入系统的UE的资源稳定性/避免多个UE抢占资源)

==物理层L1==
同样也是属于接入层AS的一部分,不过主要是在UE和nodeB之间的无线信道的基础,没有涉及信令传输的部分.

===orthogonal codes(正交编码/序列)===(25.213 spreading and modulation扩展和调制)
正交函数之间的零相关性,两个二进制序列正交(经过异或过程?)的结果大致如下(3个数之中任意2个的异或结果等于第3个数):
输入:		-1	-1	1	1
正交序列:	-1	1	-1	1
结果:		1	-1	-1	1
WCDMA的正交码通常被称为OVSF码(orthogonal variable spreading factor正交可变扩展因子)

orthogonal spreading/正交扩展:
用户的单一字符输入与对应的"扩展因子"进行异或操作后,就可以得到多个字符的输出数据,例如输入1,扩展因子是-1 1 1 -1,则得到的结果就是-1 1 1 -1.
通常 码片速率=扩展因子*符号速率,WCDMA的码片速率是3.84Mcps,所以扩展因子的选取会影响到符号速率的大小.

Recovery of spreading symbols:
扩展的还原也很简单,因为都是互相正交,将输出结果和同一个"扩展因子"再进行一次异或操作,即可得到用户的原输入数据.
WCDMA系统中应用了FEC(foward error correct前向纠错)技术去减小了"噪声"对于还原过程中的干扰,增强了系统的总体性能.

如果使用和扩展过程中不一致的"扩展因子"去还原原信号,得到的结果就会错误,结果会出现-1和1一样多的情况,且平均值一直为0的情况.

复合模拟信号是已经经过正交码多工处理的结果,将其再与一个"扩展因子"进行异或操作,通常称之为"相关",即也是我们之前提到的"还原",根据异或操作的结果得到原信号的值,这样的过程常发生在CDMA移动制式的还原信号过程中.

===PN codes===
1.Pseudorandom noise codes伪随机噪声编码
*M-序列(最大长度的伪随机二进制序列)
*gold codes(使用M-序列创造得到)

[1]M-序列:伪随机(fate机制)/二进制/最大长度(最大可以达到生成的长度,不是任意长度)
特性:
*balance:输出序列中的0和1的数量几乎相等.(2^r个1; 2^r-1个0)
*run-length:在任何时候,0或者1的连续长度不超过一半,四分之一长度的连续数不超过2次,八分之一长度的连续数不超过3次,十六分之一长度连续数不超过4次,以此类推下去......
*shift and add:The chip-by-chip sum of the output sequence Ck and any shift of itself Ck+t is a time-shifted version of the same sequence.
*autocorrelation:自动关联?

[2]Gold codes
gold codes序列的更新长度是 (2^5)-1-->31

2^r的gold codes的产生过程:在第一个生成器处有一个非0的"种子",将第二个生成器的"种子"从0到(2^r)-1进行变化,然后两个"种子"进行异或操作得到.(wtf......

只是成对的M-序列不能生成gold codes,只有被称为"preferred pairs"的成对M序列才能生成gold codes,它拥有三值自动关联和互相关功能函数.

下行gold codes序列长度为 (2^18)-1; 上行gold codes序列长度是 (2^25)-1.

2.Cross correlation of DL PN codes
WCDMA的下行gold codes:
干扰码(scrambling code)由两个输出的M序列异或操作得到,这里有512个可能生成的用于下行链路的干扰码,当结合其他的信道去完全的验证识别UE正在监听的小区.

gold codes的关联:
P117

===Generic physical layer procedures/通常的物理层程序===
25.101 UE Radio Transmission and Reception
25.104 BS Radio Transmission and Reception
25.211 Physical Channels and Mapping of Transport/Channels Onto Physical Channels (FDD)
25.212 Multiplexing and Channel Coding

•Coding
•Interleaving/交织?
•Mapping data onto physical channels
•Spreading using OVSF Channel codes
•PN Scrambling/PN干扰
•QPSK Modulation

一般物理层程序流程(从第三步开始):
[1]Data from L2, Transport Data in TTI frames
[2]Add CRC to Transport Block
[3]Channel Coding:Convolutional or Turbo
[4]rate matching
[5]1st Interleaving
[6]Radio frame segmentation 10 ms chunks
[7]Transport channel multiplexing
[8]2nd Interleaving
[9]Map to Physical Channels
[10]Spreading using Channelization(OVSF)
[11]PN scrambling
[12]QPSK Modulation

物理层需要去将传输数据然后将其承载到物理信道上,在上面的流程里,它加了一个额外的CRC并且传输数据使用了convolutional和turbo的其中一种编码方式,接下来它进行了数据交织过程和数据分段(以适应10ms的无线帧大小),采用速率匹配和传输信道多工复用去构建一个复合编码的传输信道,使其更容易去映射多个传输信道到一个物理信道上.
第二次交织提供更好的健壮性去减小在移动环境中长距离传输造成的信号损耗,应用相应的OVSF码去完成扩展过程,加扰过程使用相应的PN序列让信号处理之后看起来像是普通的热噪声信号.

这些程序流程主要是面对下行链路来分析的,但是上行链路对应的程序流程也与其相差不大.

1.FEC(foward error correction)	
对应流程[3]channel coding:convolutional or turbo

[1]convolutional卷积编码:
使用公共和专用信道; 
数据传输率<=32kbps; 
K=9,rate 1/2 or 1/3, 1bit become 2 or 3 symbols; 
Frames是zero-tailed.

[2]turbo编码:
使用专用信道; 
数据传输率>32kbps.

卷积编码对应使用Viterbi解码方式;turbo编码方式大量使用开始于90年代初,现在被大量使用,turbo编码本身也是卷积编码的一种类型,另外turbo的解码方式是使用迭代的方法直到结果在一个数上产生收敛.

卷积编码者有一个限制的长度(K=9),这个值大小是基于复杂度和性能的综合考虑得出的,数据的"zero-tailing"即是在数据流上加0来让编码器和解码器发送和接收格式相同的信息.

turbo编码者使用一个parallel concatenated(并行连接)的卷积编码方式,伴随着两个有8种状态的组合编码器,turbo编码在"大尺寸数据块"编码中是最有效的,大约比单一symbols的编码高效1000倍.

编码是在代码块上完成的,这些代码块由传输块组合形成,传输块以TTI的形式承载在传输信道上,传输块通过分段/组合的方式来适应最大的代码块大小,最大的代码块大小取决于传输信道采用的哪一种信道的编码方式.(卷积还是turbo?)

2.Interleaving/交织
对应流程[4]到[7]:
[4]rate matching
[5]1st Interleaving
[6]Radio frame segmentation 10 ms chunks
[7]Transport channel multiplexing
























