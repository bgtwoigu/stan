信令与协议

1.概述
	接口代表两个相邻实体的连接点,协议是连接点上交换信息需要遵守的规则
	简化版的OSI协议层:物理层-链路层-网络层
	物理层:传送客户的业务信息/系统各实体间的传送信令消息
	链路层:信令单元的定界,差错检验和纠错,信令链路差错率监视和流量控制
	网络层:信令网络功能管理,控制,分配
	
	GSM系统的内部接口:除去Abis和Ater各类设备存在差别外,其他接口都采用7号信令系统的标准
	GSM和PSTN,ISDN采用7号信令标准互连,各接口简单如下:
	1.Sm:人机接口,包括SIM客户识别卡和移动终端ME的接口等等
	2.Um:OTA接口,MS和BTS之间,包括无线资源管理,移动性管理,接续管理CM
	3.Abis:BSC和BTS之间,一般由设备生产方定义
+	3-5.Ater:具体来说,MSC和BSC之间有一个码型变换器TC,TC和BSC之间的接口即是Ater,而TC和MSC之间的接口才是下文的A接口.
	4.A:BSC和MSC之间,基于2Mbit/s数字接口,采用14bit七号信令方式,主要处理传递呼叫,MM,基站管理,MS管理
	5.B:MSC和VLR之间,用于MSC向VLR询问MS位置信息,或通知VLR关于MS的位置更新信息
	6.C:MSC和HLR之间,采用24bit七号信令方式,用于被叫MS用户信息传递和获取被叫用户被分配的漫游号
	7.D:HLR和VLR之间,采用24bit七号信令方式......
	8.E:两个MSC之间的接口,采用24bit七号信令方式,局间切换
	9.F:MSC和EIR之间,采用24bit七号信令方式,用于MSC检验MS的IMEI时
	10.G:两个VLR之间,当MS以TMSI启动位置更新,VLR使用G接口向前一个VLR索取MS的IMSI和相应信息
	11.NSS或BSS与OMC之间的接口:基于X.25或七号信令网的接口,执行TMN Q3协议
	
	Um接口信令协议:
	物理层:提供所需物理链路,提供各种不同功能的逻辑信道,包括业务信道和控制信道
	链路层:基于ISDN的D信道链路接入协议LAPD,在Um中接口中的第二层协议被称为LAPDm
	网络层:包括RR,MM,CM三个子层,CM中包括CC,SS补充业务控制单元,SMS短消息业务控制单元等等
	
	A接口信令协议:
	物理层:基于数字传输2Mbit/s的PCM链路,包括话音/数据信道和传输信令的信道
	链路层:基于七号信令的MTP2,集中了MTP的全部链路层协议
	网络层:BSC和MSC消息集合为BSSMAP,MS和MSC消息集合为DTAP,引入虚电路概念,每个链接建立释放独立
	
2.链路层信令协议
	MTP2,LAPD,LAPDm
	
	1.帧结构:
	所有链路建立的基本结构单元
	LAPD和MTP2采用HDLC高级数据链路控制,LAPDm是利用无线接口同步的方式来传送以帧方式定义的信息
	在HDLC中,帧起始都有一个8bit标志(01111110),如果数据中连续出现5个1,自动在后面加一个0,接收端接收时遇到连续5个1,自动减去后面的0
	Um传输的LAPDm中,无起始标志,1个LAPDm帧=1个物理层block=23Byte,在SACCH上最多为21B,因为每个SACCH块上有用于TA和传输功率控制的两个字节
		当信令长度超过帧长度限制,需要分段,分段后的每帧中多出一个bit,当还有后续帧,该bit为1,若是结尾则为0;接收端可根据此将收到结尾为1
		帧连起来,直到遇到结尾为0的帧停止,即可复原被分段的信息
	
	2.检错与纠错:
	监测可能出现的传输差错的帧,出错时请求重发
	LAPD和MTP2都是GDLC方案,每帧中增加16bit冗余bit,这被称为帧校验序列FCS
	Um上物理层已经提供了具有校验功能的传输编码方案,因此LAPDm无额外误码监测
	
	差错检验用途:提供帧内残余差错似然性的足够信息,从而重发该帧;监测链路误码率,当误码率大于4*10^-3即认为发生故障,CCS7在链路中总是工作,
	因此无信息传送时,会传送指定的填充帧
	
	非证实模式:无论接收是否接受只传一次,例如MS像BSS发送的测量报告,系统对MS切换接入的应答
	证实模式:有相应UA帧返回的都是,可以重发来纠正错误帧,大多在专用信道上的消息都是证实模式(重发次数会有限制)
	
	LAPD和MTP2的帧循环次数是128,LAPDm是8,这次为了减少帧号占用的字节,LAPD窗口尺寸可变,LAPDm固定为1
	
	释放已建立的证实模式时,使用DIST和回返UA来释放所占用的信道
	
	3.复用:
	处理同一信道上多个独立消息流的可能性
	接收端区分这些信息流,需要在每个帧中插入一个地址段
	
	SAPI业务接入点标识用于区分Um上的传送信令报文(SAPI=0)和传送短消息业务(SAPI=3)
	在Abis接口上,SAPI0对应无线信令,SAPI62对应操作维护功能信令,SAPI63对应第二层的管理信令;
	
	4.流量控制:
	信息流的总和需要小于一个链路的最大容限
	HDLC中采用"停-走"两个命令的控制来延迟发送时间,控制流量;LAPDm中没有此功能
	
P94	5.LAPD和LAPDm帧比较
	LAPD:	flag(1B)	SAPI TEI终端设备识别标识(地址)	N(s)N(R)(控制)		0-260B(信息)	FCS帧检查序列(2B)	flag(1B)
	LAPDm:	SAPI(地址)	N(s)N(R)(控制)		0-21B(信息)
	
3.网络层信令协议
涉及两个非直接互连实体的应用协议,网络层即建立一个这样的连续链路段,支持两个实体之间并行存在的几个独立连接,分别对应于不同的应用通信
网络层基本概念是编码,在报文上加标记,从而区分不同的消息流
	
	1.无线接口Um?
	CM(SS,CC); MM; RR
	通过SAPI(业务接入点识别符)和PD(协议鉴别器)区分信令消息和短消息,PD就是一个网络编址,
	无线接口上的协议鉴别器:MM,RR,CC,SS
	信源点会把PD插入到消息中去,MS到网络侧的方向上,BSC利用PD判断收到的消息,若是RR类,
	则本身就可处理,若是其他的则要送入MSC,MS和MSC根据收到报文的PD把它们分配到合适的软件模块
	
	区分CC和SS:由一个事务处理识别符TI来识别,TI由信源点实体插入,宿点可以根据收到的PD和TI消息分配到合适的上下文中
	
	2.Abis接口
	Abis接口上的每一个消息都要附上一个消息鉴别器MD以及一些附加数据
	
	报文鉴别器MD+附加数据:						源点-宿点:	作用:
	无线链路层管理+信道参考+无线链路参考		MS-BSC		无线路径消息中继
	专用信道参考+信道参考						BTS-BSC		与给定的业务信道互连
	公共信道参考+信道参考						BTS-BSC		与给定的BCCH或CCCH/RACH互连
	TRX管理										BTS-BSC		控制TRX状态
	
	3.A 接口
	包含MS-MSC和BSC-MSC的消息类型,合称为BSSMAP
	BSSMAP负责处理BSS部分资源管理和切换控制等消息,BSSMAP使用SCCP无连接和面向连接两种方式,对单个呼叫有关的信息处理程序和资源管理的程序等等采用SCCP无连接方式,
	与无线接口上的单个无线资源有关的程序,采用SCCP的面向连接方式
	DTAP用来传输MS有关的呼叫控制和移动性管理消息,不对内容分析,大多数的无线接口消息由DTAP方式在MSC-BSS接口上传送
	
	在A接口上引入"虚电路"概念,每个连接的建立释放都是独立的,即SS7中的SCCP
	SCCP不是GSM专用协议,在MTP协议的上层,但并不是SS7内的基本网络协议,SCCP包含多条虚电路,可以支持建立多条连接,对应每一个MS
	
	MTP3信令网管理功能:话务管理(信令网故障时,将信令流链路或路由进行切换),信令链路管理(信令网中恢复,启用,退出信令链路),信令路由管理(保证可靠的在信令点之间交换有关信令路由可用性的信息,包括传递,限制和禁止程序)
	
	SCCP支持的功能:面向连接,无连接,SCCP管理,信令帧组的选路功能
	
	BSSMAP和DTAP可以定义在同一无线连接上,但其处理不同,需要在SCCP上加一个头标志区分,对于DTAP消息,BSC是MS和MSC之间的传输点;对于BSSMAP,BSC是端点
	PS:DTAP携带有它在无线接口传输中的链路类型消息,因此这个"数据链路连接标识"DLCI要和Abis接口上使用的链路标识相匹配
	
	4.NSS层接口
	在网络侧的内部连接,各设备接口各不相同,MTP上的协议都与所涉及的功能实体有关
	CCS7信令协议层级关系:	
	TUP		ISUP	MAP		BSSMAP
	.		.		TCAP	.
	.		.		SCCP	SCCP
	MTP		MTP		MTP		MTP(消息传送部分)
	MTP功能在于在节点之间向上层"用户"提供稳定可靠的信息传输能力
	SCCP和MTP共同形式MTP3这一层,SCCP主要用于传送电路交换控制以外信令和数据
		无连接模式:每个信令帧都包含地址,用此地址可选择到达目标地
		面向连接模式:消息源会有一个引导帧组,通过信令网路到达目的地,这种方式也被称作虚电路连接
	信令越多的采用会话进行方式通信,在链路的远端请求操作中,MTP+SCCP不再合适,在SCCP上层加TCAP层(事务处理应用部分)
	
	TCAP目的是为节点间信息传输提供公共系统,支持各种新业务的登记\撤销\申请\管理
	组元处理:TC客户间交换的协议数据单元,借助此单元向远端请求操作并得到应答
	会话处理(事务处理子层):客户间用会话方式可以交换大量信息,在客户间同时提供几个会话,分为结构性(需要用户响应)和非结构性会话
	
	MAP移动应用部分建立在TCAP上,使用SCCP的无连接方式
	作为TCAP的客户,使用组元会话的方式,处理MSC,HLR,VLR等不同物理实体间的同等层间的通信,MAP包含ASE功能块,用于节点同等曾间的通信,
	MAP协议还支持一个物理实体与多个物理实体通信,主要功能是支持MS的位置登记\删除\用户业务管理\用户参数设置\漫游\越区切换\鉴权\保密数据传输等
	
	MSC-PSTN --> TUP
	MSC-ISDN --> ITUP
	
4.GSM信令网
	由CCS7信令系统作为基础,发展起来的GSM信令网,由信令链路SL,信令点SP,信令转接点STP三部分组成
	1.网络构成
	分为三级:高级信令转接点HSTP,低级信令转接点LSTP,信令点SP
	对应:一级业务汇接中心,二级移动业务汇接中心,移动业务本地网
	
	SP至少包含一个HLR以及一个或多个MSC,每个MSC与所在地区长途局相连,并与当地市话汇接局和PLMN局相连
	LSTP设置在各省各地,一个SP至少连接2个LSTP,构成星状/网状拓扑
	HSTP是单独设置的,仅作汇接作用
	
	2.网络组织
	各省设置若干LSTP,每个SP至少连接2个LSTP,并采用负荷分担工作方式
	至少设置两条信令链,每条链尽可能采用分开的物理通路,采用负荷分担工作方式
	设置经STP转接的迂回路由
	当两信令点间信令量很大,可设置直达链路,采用直连方式工作
	PLMN中BSC和MSC采用24bit七号信令方式,但BSC信令点编码一般采用14bit编码,由每个MSC自定
	
	正常路由:未发生故障信令业务流的路由,分为直连方式和准直连方式路由
	迂回路由:因信令链或路由故障造成的正常路由不能传输信令流时选择的路由,经过STP的准直连方式,当有多个迂回路由,经过STP点次数越小的优先级越高,根据优先级选择使用
	
	选择原则:正常路由-->迂回路由(根据优先级判定从第一个开始选择)-->若迂回路由优先等级一样,则平均分担信令负荷,若又出现信令链组故障则
	将信令业务换到同样采用负荷分担方式的其他信令链组,若采用负荷分担的其中一个路由故障,则将信令业务换到其他路由
	
	3.信令点编码方式
	GSM信令网信令点采用24比特编码方式,但由于MSC-BSC间是点对点传递,BSC仍旧维持14bit信令点编码方式
	
	1.编码方案原则:
	信令网中每一个STP和SP均分配一个信令点编码
	同时编制14bit和24bit
	移动网的24bit和固定网的24bit编码互相独立
	
	2.编码方案:
	24bit信令点编码:主信令区8bit(各省公用网分配)	分信令区8bit(从七号信令网分信令区编码启用的FF,FE)	信令点8bit(高5低3的比特位原则)
	信令点高五位:
	00000			一级汇接局							每省8个
	00001/00010		二级汇接局							每省16个
	00011-11111		直辖市汇接区省/自治区的地区/市		每省29*8个
	信令点低3位:
	000			HLR/AUC		1/地区
	001-110		MSC/VLR		6/地区
	111			EIR			1/地区
	
	
	14bit信令点编码:主信令区5bit(各省/自治区/直辖市分配)	分信令区5bit(如下)		信令点4bit(如下)
	分信令区编码分配:
	00000			一级汇接局							每省16个
	00001			二级汇接局							每省16个
	00010-11111		直辖市汇接区省/自治区的地区/市		每省30*16个
	信令点编码分配:
	0000			HLR/AUC		1/分信令区
	0001			EIR			1/分信令区
	0010-0101		MSC			4/分信令区
	111				BSC			10/分信令区

	4.信令网寻址方式
	信令链路上每一个消息都有一个标记
	分类:CIC电路识别码(标识消息属于哪条话音电路);ODC消息源信令点编码(标识发出消息的信令点SP);DPC目的地信令点编码(标识消息的目的地信令点SP)
	
	GSM信令网的SP和STP间传递MAP消息必须要有SCCP的支持,SCCP地址由GT(全局名),DPC和SSN组成
	
	我国GSM信令网SCCP寻址方式:国际间采用GT方式,省内采用24bit的DPC和SSN寻址,省间采用GT寻址
	
	GT是一种地址,是移动客户的MSISDN号,翻译节点被贵点在每条SCCP消息收端省的LSTP上
	
	GSM网内子系统编号SSN:
	HLR		00000110
	VLR		00000111
	MSC		00000100
	EIR		00001001
	AUC		00001010
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	